---
title: å›¾åƒå¤„ç†ï¼ˆä¸€ï¼‰â€”â€”å¸¸è§æ“ä½œ
date: 2020-04-07 23:40:00.0
updated: 2021-09-03 20:15:17.008
url: /archives/tu-xiang-chu-li--yi--chang-jian-cao-zuo
categories: 
- å›¾åƒå¤„ç†
tags: 
- å›¾åƒå¤„ç†
- python

---
äº†è§£æ¨¡ç³Šã€æº¶è§£ç­‰å›¾å½¢å­¦åŸºæœ¬æ“ä½œ
<!--more-->

# å›¾åƒå¤„ç†ç¬”è®°(ä¸€)å¸¸è§æ“ä½œ

## ç›´æ–¹å›¾å‡è¡¡åŒ–

### å‚è€ƒæ–‡æ¡£

[1] Jan Erik Solem. Pythonè®¡ç®—æœºè§†è§‰ç¼–ç¨‹ (å›¾çµç¨‹åºè®¾è®¡ä¸›ä¹¦) (p. 11). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾.

[2] ç›´æ–¹å›¾å‡è¡¡åŒ–

### ä»£ç 



```python
# ç›´æ–¹å›¾å‡è¡¡åŒ–
def histeq(im, nbr_bins = 256):
    """
    å¯¹ä¸€å‰¯ç°åº¦å›¾åƒè¿›è¡Œç›´æ–¹å›¾å‡è¡¡åŒ–
    """
    # è®¡ç®—å›¾åƒçš„ç›´æ–¹å›¾
    imhist, bins = histogram(im.flatten(), nbr_bins, normed = True)
    cdf = imhist.cumsum()
    cdf = 255 * cdf / cdf[-1]
    
    # ä½¿ç”¨ç´¯ç§¯åˆ†å¸ƒå‡½æ•°çš„çº¿æ€§æ’å€¼ï¼Œè®¡ç®—æ–°çš„åƒç´ å€¼
    im2 = interp(im.flatten(), bins[:-1], cdf)
    return im2.reshape(im.shape), cdf
```

### è®²è§£

#### è§£å†³çš„é—®é¢˜

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233710618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

 é€šå¸¸ï¼Œæš—å›¾åƒç›´æ–¹å›¾çš„åˆ†é‡é›†ä¸­åœ¨ç°åº¦è¾ƒä½çš„ä¸€ç«¯ï¼Œè€Œäº®å›¾åƒç›´æ–¹å›¾åˆ†é‡åå‘äºç°åº¦è¾ƒé«˜çš„ä¸€ç«¯ã€‚

ä»å›¾ä¸­å¯ä»¥å¾—åˆ°è¿™æ ·çš„ç»“è®ºï¼šå¦‚æœä¸€å¹…å›¾åƒçš„ç°åº¦ç›´æ–¹å›¾å‡ ä¹è¦†ç›–äº†æ•´ä¸ªç°åº¦çš„å–å€¼èŒƒå›´ï¼Œå¹¶ä¸”é™¤äº†ä¸ªåˆ«ç°åº¦å€¼çš„ä¸ªæ•°è¾ƒä¸ºçªå‡ºï¼Œæ•´ä¸ªç°åº¦å€¼åˆ†å¸ƒè¿‘ä¼¼äºå‡åŒ€åˆ†å¸ƒï¼Œé‚£ä¹ˆè¿™å¹…å›¾åƒå°±å…·æœ‰è¾ƒå¤§çš„ç°åº¦åŠ¨æ€èŒƒå›´å’Œè¾ƒé«˜çš„å¯¹æ¯”åº¦ï¼ŒåŒæ—¶å›¾åƒçš„ç»†èŠ‚æ›´ä¸ºä¸°å¯Œã€‚å·²ç»è¯æ˜ï¼Œä»…ä»…ä¾é è¾“å…¥å›¾åƒçš„ç›´æ–¹å›¾ä¿¡æ¯ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå˜æ¢å‡½æ•°ï¼Œåˆ©ç”¨è¯¥å˜æ¢å‡½æ•°å¯ä»¥å°†è¾“å…¥å›¾åƒè¾¾åˆ°ä¸Šè¿°æ•ˆæœï¼Œè¯¥è¿‡ç¨‹å°±æ˜¯ç›´æ–¹å›¾å‡è¡¡åŒ–ã€‚

ä¸€å¥è¯è¯´ï¼Œå°±æ˜¯ç›´æ–¹å›¾çš„å€¼éƒ½èšåœ¨ä¸€å—ä¸æ¸…æ¥šï¼Œå‡è¡¡åŒ–ä¹‹åèƒ½æ¸…é™¤å¾ˆå¤šã€‚

### æ–¹æ³•

å°†å›¾åƒä¸­çš„ç°åº¦çº§å‡åŒ€çš„æ˜ å°„åˆ°æ•´ä¸ªç°åº¦çº§èŒƒå›´ï¼Œå…·ä½“çš„æ–¹æ³•å¦‚ä¸‹ï¼š

* å‰æå‡è®¾ï¼šåœ¨ä¸€å¼ æœ‰Nä¸ªåƒç´ ç‚¹çš„å›¾ç‰‡ä¸­ï¼Œæœ‰ç°åº¦å€¼çš„å–å€¼èŒƒå›´æ˜¯0~Mï¼Œä½ å¸Œæœ›æ˜ å°„åˆ°çš„èŒƒå›´æ˜¯$[x,y]$
* ç¬¬ä¸€æ­¥ï¼šç»Ÿè®¡æ¯ä¸€ä¸ªç°åº¦å€¼å‡ºç°çš„æ¬¡æ•°$t_i$ï¼Œå…¶ä¸­$i$ä»£è¡¨ç°åº¦ï¼Œ$t_i$ä»£è¡¨å…¶å‡ºç°çš„æ¬¡æ•°
* ç¬¬äºŒæ­¥ï¼šè®¡ç®—æ¯ä¸€ç§ç°åº¦å€¼å¯¹åº”çš„åƒç´ ç‚¹ä¸ªæ•°åœ¨æ€»ä½“ä¸­å æ¯”$P_i = \frac{t_i}{N}$
* ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—ç´¯è®¡å æ¯”$\sigma P_i=\Sigma_{i=0}^{i}P_i$
* ç¬¬å››æ­¥ï¼šè®¡ç®—æ˜ å°„åçš„ç°åº¦å€¼$final_i=\sigma P_i*(y-x+1)$ 

## å›¾åƒå¹³å‡

### ä»£ç 

```python
def compute_average(imList):
    """
    è®¡ç®—å›¾åƒåˆ—è¡¨çš„å¹³å‡å›¾åƒ
    imList ï¼š ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«å¾ˆå¤šå›¾åƒ
    """
    # æ‰“å¼€ä¸€å¼ å›¾åƒï¼Œå°†å…¶å­˜æ”¾åœ¨æµ®ç‚¹æ•°ç±»å‹æ•°ç»„ä¸­
    averageim = array(Image.open(imlist[0]), 'f')
    
    for imname in imlist[1:]:
        try:
            averageim += array(Image.open(imname))
        except:
            print(imname + '...skipped')
    averageim /= len(imlist)
    
    return array(averageim, 'uint8')

```

### è®²è§£

æ²¡å•¥å¥½è®²çš„ï¼ŒæŠŠä¸€å †å›¾æ‹‰åˆ°ä¸€å—ï¼Œå¹³å‡ä¸€ä¸‹å³å¯ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨äºé™å™ªï¼Œ ä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¼šå‘ç°ï¼Œè¿™ä¸ªæ–¹æ³•è¦æŠŠæ‰€æœ‰å›¾ç‰‡éƒ½æ‹‰åˆ°å†…å­˜é‡Œï¼Œå¦‚æœè¦å¹³å‡å¾ˆå¤šçš„å›¾ç‰‡çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ‹‰å¾ˆå¤šçš„å†…å­˜ï¼Œä¸è¿‡åˆæœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯å¯ä»¥æ¯æ¬¡å¹³å‡ä¸€å¼ ä¹Ÿå°±æ˜¯æ¯æ¬¡æ–°å¼•å…¥ä¸€å¼ ï¼Œä¹Ÿå¯ä»¥ã€‚

## å›¾åƒçš„ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰

### å‚è€ƒèµ„æ–™

[1] Jan Erik Solem. Pythonè®¡ç®—æœºè§†è§‰ç¼–ç¨‹ (å›¾çµç¨‹åºè®¾è®¡ä¸›ä¹¦) (p. 11). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾.

[2] [æœºå™¨å­¦ä¹ ç»å…¸ç®—æ³•ï¼šPCAé™ç»´ä¸SVDçŸ©é˜µåˆ†è§£]( https://www.bilibili.com/video/BV1F441187rd?from=search&seid=4973130116529586818 )â€”â€” [è‡ªå…´äººå·¥æ™ºèƒ½æ•™è‚²](https://space.bilibili.com/410704854) 

ä¸»æˆåˆ†åˆ†ææ³•ï¼Œè€æœ‹å‹äº†ã€‚è¿™ä¸ªç›®å‰å·²çŸ¥çš„æœ‰ä¸¤ç§ç”¨æ³•ï¼š

* é™ä½æ•°æ®ç»´åº¦
* æ±‚æ¯ä¸€ä¸ªå€¼åœ¨æ€»ä½“ä¸­çš„å®¢è§‚æƒé‡ï¼ˆé‡è¦ç¨‹åº¦ï¼‰

åˆ©ç”¨è¿™ä¸ªå¯ä»¥åšå›¾åƒçš„ç¼©ç•¥å›¾ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯èƒ½åœ¨é™ç»´çš„æ—¶å€™ï¼ŒåŒæ—¶å°½é‡å¤šçš„ä¿æŒè®­ç»ƒæ•°æ®çš„ä¿¡æ¯ï¼Œè¿™å°±å¾ˆnbäº†ã€‚

### ä»£ç 

```python
# PCA
def pca(X):
    """
    ä¸»æˆåˆ†åˆ†ææ³•ï¼š
    è¾“å…¥ï¼š çŸ©é˜µXï¼Œå…¶ä¸­è¯¥çŸ©é˜µä¸­å‚¨å­˜è®­ç»ƒæ•°æ®ï¼Œæ¯ä¸€è¡Œä¸ºä¸€æ¡è®­ç»ƒæ•°æ®
    è¿”å›ï¼šæŠ•å½±çŸ©é˜µï¼ˆæŒ‰ç»´åº¦çš„é‡è¦æ€§æ’åºï¼‰ã€æ–¹å·®å’Œå‡å€¼
    """
    # è½¬åŒ–æˆnumpy.arrayçŸ©é˜µ
    X = np.array(X)
    
    # è·å–ç»´åº¦
    num_data, dim = X.shape
    
    # æ•°æ®ä¸­å¿ƒåŒ–
    mean_X = X.mean(axis = 0)
    X = X - mean_X
    
    if(dim > num_data):
        # PCA - ä½¿ç”¨ç´§è‡´æŠ€å·§
        M = dot(X,X.T) # åæ–¹å·®çŸ©é˜µ
        e, EV = linalg.eigh(M) # ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
        tmp = dot(X.T, EV).T #ç´§è‡´æŠ€å·§ï¼Ÿï¼Ÿï¼Ÿè¯´å®è¯æˆ‘è¿˜æ˜¯ä¸æ‡‚
        V = tmp[::-1]# ç”±äºæœ€åçš„ç‰¹å¾å‘é‡æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œæ‰€ä»¥è¦å°†å®ƒé€†è½¬
        S = sqrt(e)[::-1]# ç”±äºç‰¹å¾å€¼æ˜¯æŒ‰ç…§é€’å¢é¡ºåºæ’åˆ—çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶é€†è½¬
        for i in range(V.shape[1]):
            V[:, i] /= S
    else :
        # PCA- ä½¿ç”¨SVDæ–¹æ³•
        U, S, V = linalg.svd(X)
        V = V[:num_data] # ä»…ä»…è¿”å›å‰num_data ç»´çš„æ•°æ®æ‰åˆç†
        
    return V, S, mean_X
```

### åŸç†

#### PCA

##### PCAåšäº†ä»€ä¹ˆï¼Ÿ

ä¼—æ‰€å‘¨çŸ¥ï¼ŒPCAå¯ä»¥ç”¨æ¥é™ç»´ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç°åœ¨ç”±ä¸€ç»„æ•°æ®ï¼Œè§„æ ¼æ˜¯100\*4çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰100ç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®æœ‰4ä¸ªç‰¹å¾ï¼Œç°åœ¨æˆ‘ä»¬æƒ³æŠŠå®ƒçš„æ¯ä¸€ç»„ç‰¹å¾çš„æ•°ç›®é™åˆ°2ï¼Œå˜åŒ–å®Œæˆåï¼Œå˜æˆ100\*2çš„çŸ©é˜µï¼Œé‚£ä¹ˆè¿™ä¸ªå˜åŒ–éœ€è¦ä»€ä¹ˆå‘¢ï¼Ÿå­¦è¿‡çº¿ä»£çš„åŒå­¦éƒ½æ‡‚äº†ï¼Œè¿™é‡Œéœ€è¦åœ¨ä¹˜ä¸Šä¸ª4\*2çš„çŸ©é˜µå°±å¯ä»¥å®Œæˆè¿™ç§å˜åŒ–ï¼Œé‚£ä¹ˆæ±‚è¿™ä¸ª4\*2çš„çŸ©é˜µï¼Œå°±æ˜¯PCAçš„ä¸»è¦ä»»åŠ¡ã€‚

##### æ“ä½œæµç¨‹

* ç¬¬ä¸€æ­¥ï¼šå…ˆå¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–æ“ä½œ

* ç¬¬äºŒæ­¥ï¼šè®¡ç®—åæ–¹å·®çŸ©é˜µ

  ä»€ä¹ˆæ˜¯åæ–¹å·®ï¼š

  åæ–¹å·®ï¼š$\sigma_{jk}=\frac{1}{n-1}\Sigma_{i=1}^n(x_{ij}-x_{j}.mean)(x_{ik}-x_k.mean)$

  åæ–¹å·®ä»£è¡¨ç€ä¸¤ä¸ªæ•°æ®ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œç›¸å…³æ€§è¶Šå¤§ï¼Œåæ–¹å·®è¶Šå¤§

  åæ–¹å·®çŸ©é˜µè•´å«ç€ä»»æ„ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„åæ–¹å·®

  åæ–¹å·®çŸ©é˜µçš„è®¡ç®—ï¼š$\Sigma=\frac{1}{n-1}((X-x.mean^T(X-x.mean))$

* å¯¹åæ–¹å·®çŸ©é˜µæ±‚ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼š

  ä»€ä¹ˆæ˜¯ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡?

  çº¿æ€§ä»£æ•°å­¦äº†ä¸€å¹´å¤šäº†ï¼Œç°åœ¨åªè®°å¾—åŠ å‡ä¹˜å’Œè½¬ç½®äº†ï¼Œå–ä¸ªé€†éƒ½æ˜¯é«˜ç«¯æ“ä½œäº†ï¼Œç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡æ˜¯å•¥æ¥ç€ï¼Ÿä¸è®°å¾—äº†ã€‚

  ç›´æ¥çœ‹å®šä¹‰ï¼š$A$ æ˜¯$n$é˜¶æ–¹é˜µï¼Œè‹¥å­˜åœ¨æ•°$\lambda$å’Œéé›¶å‘é‡xä½¿å¾—$Ax = \lambda x$é‚£ä¹ˆç§°$\lambda$æ˜¯Açš„ä¸€ä¸ªç‰¹å¾å€¼ï¼Œ$x$ä¸ºAçš„å¯¹åº”äºç‰¹å¾å€¼$\lambda$çš„ç‰¹å¾å‘é‡ã€‚

  æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªè¿™æ ·çš„çŸ©é˜µï¼š
  $$
  a = \left[
  \begin{matrix}
  1 & 2&3&4\\
  2&1&5&6\\
  3&5&1&7\\
  4&6&7&1
  \end{matrix}
  \right]
  $$
  æˆ‘ä»¬ä½¿ç”¨è¯­å¥ï¼šnp.linalg.eig(a)ï¼Œå¾—åˆ°äº†ä»¥ä¸‹ç»“æœ

  ```python
  In [9]: a = np.array([[1,2,3,4],[2,1,5,6],[3,5,1,7],[4,6,7,1]])
  In [10]: b,c = np.linalg.eig(a)
  In [11]: b, c
  Out[11]:
  (array([15.01698746, -0.67469831, -4.04123361, -6.30105553]),
   array([[ 0.35249192,  0.89949656, -0.21038586, -0.14964351],
          [ 0.49287878, -0.40507255, -0.72842863, -0.24975682],
          [ 0.54203206, -0.15251679,  0.63351659, -0.53065677],
          [ 0.58225527, -0.05967247,  0.15422794,  0.79600989]]))
  ```

  æˆ‘ä»¬æ ¹æ®åˆšæ‰çš„å®šä¹‰è¿›è¡Œæ£€éªŒï¼š

  ```python
  In [26]: b[0]*c[:,0]
  Out[26]: array([5.29336674, 7.40155453, 8.13968862, 8.74372006])
  In [27]: np.dot(a,c[:,0])
  Out[27]: array([5.29336674, 7.40155453, 8.13968862, 8.74372006])
  ```

  ```python
  In [28]: b[1]*c[:,1]
  Out[28]: array([-0.60688881,  0.27330177,  0.10290282,  0.04026092])
  
  In [29]: np.dot(a,c[:,1])
  Out[29]: array([-0.60688881,  0.27330177,  0.10290282,  0.04026092])
  ```

  æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†å››ç»„ç‰¹å¾å‘é‡å’Œç‰¹å¾å€¼ï¼Œæ®è¯´ç‰¹å¾å€¼ä»£è¡¨ç€å½“å‰ç‰¹å¾å‘é‡çš„é‡è¦ç¨‹åº¦ã€‚

  å¯¹è¿™äº›ç‰¹å¾å€¼è¿›è¡Œå½’ä¸€åŒ–ï¼Œå°†ä»–ä»¬æ˜ å°„åˆ°1~100çš„åŒºé—´ä¸­ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233729395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

  å¯ä»¥çœ‹åˆ°ï¼Œåä¸¤ä¸ªç‰¹å¾å€¼éƒ½å¤ªå°äº†ï¼Œè€Œä¸”æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æŠŠè¿™ä¸ª100\*4çš„çŸ©é˜µè½¬åŒ–æˆ100\*2çš„çŸ©é˜µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€‰å–ä¸¤ä¸ªç‰¹å¾å‘é‡ï¼Œæ‰€ä»¥å‘¢æˆ‘ä»¬å°±å»é€‰æœ€å¤§çš„ä¸¤ä¸ªç‰¹å¾å€¼æ‰€å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œä¹Ÿå°±æ˜¯ç‰¹å¾å‘é‡0å’Œ1ã€‚

  å°†ä»–ä»¬åˆæˆä¸€ä¸ª4*2çš„çŸ©é˜µï¼Œè®¡ç®—åŸçŸ©é˜µä¸ä»–ä»¬çš„çŸ©é˜µä¹˜æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°æ–°çš„ç‰¹å¾çŸ©é˜µäº†ã€‚

#### SVDçŸ©é˜µåˆ†è£‚

##### ç›®æ ‡

å°†ä¸€ä¸ªçŸ©é˜µAåˆ†è§£ä¸‰ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ï¼š

å¦‚ä¸‹:

```mermaid
graph LR
A[A m*n] -->u[u m*m]
A[A m*n] -->S[S m*n]
A[A m*n] -->V[V n*n]

```

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†ä¸€ä¸ªm\*nçš„çŸ©é˜µAæ‹†åˆ†æˆu\*S\*Vçš„å½¢å¼ï¼Œä»–ä»¬çš„å½¢çŠ¶å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

å…¶ä¸­Sæ˜¯ä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼Œå¯¹è§’çŸ©é˜µå°±æ˜¯åªæœ‰ä¸»å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¸æ˜¯é›¶çš„çŸ©é˜µï¼Œä½ è¿˜çœ‹ä¸æ‡‚ä»€ä¹ˆå«å¯¹è§’çŸ©é˜µçš„è¯å»ºè®®ç™¾åº¦ã€‚

å‰©ä¸‹çš„çœ‹è¿™ç¯‡åšå®¢ https://mp.weixin.qq.com/s/Dv51K8JETakIKe5dPBAPVg 



## ä½¿ç”¨pickleæ¨¡å—

pickleå¯ä»¥æ¥å—å‡ ä¹æ‰€æœ‰pythonçš„å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš**å°è£…(pickling)**ã€‚ä»å­—ç¬¦ä¸²è¡¨ç¤ºä¸­é‡æ„è¯¥å¯¹è±¡ï¼Œæˆä¸º**æ‹†å°(unpickling)**ã€‚è¿™äº›å­—ç¬¦ä¸²è¡¨ç¤ºå¯ä»¥æ–¹ä¾¿çš„å‚¨å­˜å’Œä¼ è¾“ã€‚

### å‚¨å­˜

```python
f = open('font_pca_modules.pkl', 'wb')
pickle.dump(immean,f)
pickle.dump(V,f)
f.close()
```

åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œè®¸å¤šå¯¹è±¡å¯ä»¥ä¿å­˜åˆ°åŒä¸€æ–‡ä»¶ä¸­ã€‚pickleæ¨¡å—ä¸­æœ‰å¾ˆå¤šä¸åŒåè®®å¯ä»¥ç”Ÿæˆ.pklæ–‡ä»¶ï¼Œå¦‚æœä¸ç¡®å®šçš„è¯ï¼Œæœ€å¥½ä»¥äºŒè¿›åˆ¶æ–‡ä»¶çš„å½¢å¼å»è¯»å–ã€å†™å…¥ã€‚åœ¨å…¶ä»–pythonä¼šè¯ä¸­è½½å…¥æ•°æ®ï¼Œåªéœ€è¦ä½¿ç”¨load()æ–¹æ³•ã€‚

### è¯»å–

```python
f = open('font_pca_modules.pkl', 'rb')
immean = pickle.load(f)
V = pickle.load(f)
f.close()
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdumpçš„é¡ºåºå’Œloadçš„é¡ºåºå¿…é¡»ä¸€æ ·ï¼Œå½“ç„¶ï¼Œä¸æ–‡ä»¶ç›¸å…³çš„è¯»å†™æ“ä½œå¯ä»¥ç”¨withè¯­å¥å®Œæˆï¼Œè¿™æ ·å¯ä»¥é¿å…æ–‡ä»¶å¼€å…³å¯¼è‡´çš„é”™è¯¯ã€‚

### ä½¿ç”¨withçš„ä¿å­˜å’Œè½½å…¥

#### ä¿å­˜

```python
with open('font_pca_modules.pkl', 'wb') as f:
    pickle.dump(immean,f)
	pickle.dump(V,f)
```

#### è½½å…¥

```python
with open('font_pca_modules.pkl', 'rb') as f:
    immean = pickle.load(f)
	V = pickle.load(f)
```

ä»æœ¬è´¨ä¸Šè¯´è¿™ä¸¤ç§æ–¹æ³•æ²¡ä»€ä¹ˆä¸åŒçš„ï¼Œå°±æ˜¯åœ¨withçš„ä½œç”¨åŸŸä¸­ï¼Œfæ˜¯å¼€çš„ï¼Œå‡ºäº†withçš„ä½œç”¨åŸŸåï¼Œfå°±ä¼šè‡ªåŠ¨å…³é—­ï¼Œå½“ç„¶æˆ‘æœ¬äººæ˜¯ä¸å–œæ¬¢è¿™ç§ä»£ç å½¢å¼çš„ï¼Œä½†æ˜¯ä¸ºäº†è®©è‡ªå·±çš„ä»£ç é£æ ¼å°½é‡è§„èŒƒï¼Œæˆ‘å†³å®šé€‚åº”è¿™ä¸€å½¢å¼ã€‚

## Scipy

### å›¾åƒæ¨¡ç³Š

ä½œè€…åœ¨è¿™é‡Œåˆä¸ç»æ„çš„æŠ›å‡ºäº†ä¸€ä¸ªé‡ç‚¹ã€‚ã€‚

å›¾åƒçš„**é«˜æ–¯æ¨¡ç³Š**çš„å®è´¨å°±æ˜¯ç°åº¦å›¾åƒIå’Œä¸€ä¸ªé«˜æ–¯æ ¸è¿›è¡Œå·ç§¯çš„æ“ä½œã€‚

è¿™é‡Œç»™æ²¡æœ‰å…¥é—¨çš„å…„å¼ŸèŒè®²ä¸€ä¸‹ï¼Œä»€ä¹ˆå«å·ç§¯ï¼Œæ•°å­¦ä¸Šä¸¤ä¸ªå‡½æ•°çš„å·ç§¯ï¼Œæˆ‘ç›®å‰è¿˜æ²¡æœ‰å­¦ï¼ˆå¤§äºŒä¸‹ï¼‰ã€‚å›¾çš„å·ç§¯åªæ˜¯å€Ÿäº†ä¸€ä¸ªæ¦‚å¿µè€Œå·²ï¼Œç®€å•åœ°è®²ï¼šå‡å¦‚æœ‰ä¸€ä¸ª$n \times n$çš„çŸ©é˜µA ï¼Œè¿˜æœ‰ä¸€ä¸ª$3 \times3$çš„æ»¤æ³¢å™¨Bã€‚ä¸è¦çº ç»“ä»€ä¹ˆå«æ»¤æ³¢å™¨ï¼Œä¸‹é¢ä¼šè®²æ¸…æ¥šçš„ã€‚ä»–ä»¬ç°åœ¨åˆ†åˆ«é•¿è¿™ä¸ªæ ·å­ï¼š
$$
A = 
\left[
\begin{matrix}
a_{1,1} & a_{1,2} &... & a_{1,n} \\
a_{2,1} & a_{2,2} &... & a_{2,n} \\
...  &...& &... \\
a_{n,1} &a_{n,2}&... &a_{n,n}
\end{matrix}
\right],
B = 
\left[
\begin{matrix}
-1&0&1\\
-1&0&1\\
-1&0&1
\end{matrix}
\right]
$$
Aå’ŒBè¿›è¡Œå·ç§¯æ“ä½œï¼Œç”Ÿæˆäº†ä¸ªä»€ä¹ˆç©æ„å‘¢?å¾ˆç®€å•ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„çŸ©é˜µï¼Œè¿™ä¸ªçŸ©é˜µçš„æ¯ä¸€ä¸ªå…ƒç´ å°±åƒæ˜¯ä¸‹é¢çš„å›¾ç‰‡é‡Œä¸€æ ·ï¼ˆç‰¹æ®Šè¯´æ˜ï¼šä¸‹é¢çš„å›¾ç‰‡æ˜¯æˆ‘åœ¨[è¿™ä¸ªç½‘ç«™]( https://www.cnblogs.com/SivilTaram/p/graph_neural_network_2.html )ä¸Šé¢ç›´æ¥æ‹¿çš„ï¼‰

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMuY25ibG9ncy5jb20vY25ibG9nc19jb20vU2l2aWxUYXJhbS8xNTEwNDg1L29faW1hZ2UtMTMtY29udi1jbm4uZ2lm)

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªè”æƒ³ï¼Œå·ç§¯å°±æ˜¯æ‹¿ç€ä¸€ä¸ªæ”¾å¤§é•œæŠŠè¿™ä¸ªå›¾æ‰«ä¸€éç”Ÿæˆä¸€å¼ æ–°çš„å›¾ï¼Œæ”¾å¤§é•œ(ä¹Ÿå°±æ˜¯æ»¤æ³¢å™¨)ä¸ä¸€æ ·ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿä¸ä¸€æ ·ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å¯¹ä¸€å¼ å›¾ç‰‡è¿›è¡Œé«˜æ–¯æ¨¡ç³Šã€‚talk is freeï¼Œä»£ç æ¥äº†ï¼š

```python
from PIL import Image
from numpy import *
from scipy.ndimage import filters
def compare(im1, im2, module = 'gray'):
    """
    åœ¨ä¸€å¼ å›¾é‡Œé¢æ˜¾ç¤ºä¸¤ä¸ªå›¾ç‰‡
    """
    fig, ax = plt.subplots(figsize=(12,8),ncols=2,nrows=1)
    ax[0].imshow(im1, module)
    ax[1].imshow(im2, module)
    plt.show()
    
im = array(Image.open("C:\\Users\\wangsy\\Desktop\\learning\\timg.jpg").convert("L"))
im2 = filters.gaussian_filter(im, 5)

compare(im, im2)
```

ä¸»ä½“å°±åªæœ‰ä¸‹é¢ä¸¤è¡Œï¼Œfilters.gaussian_filter(im, 5)ï¼Œè¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨éœ€è¦è¿›è¡Œé«˜æ–¯æ¨¡ç³Šçš„çŸ©é˜µï¼Œç¬¬äºŒä¸ªä»£è¡¨æ ‡å‡†å·®ï¼Œè¿™ä¸ªå¤§å®¶éƒ½æ‡‚ï¼Œæœ€åçš„æ•ˆæœå¦‚ä¸‹:

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233741180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

æˆ‘ä»¬å°†æ ‡å‡†å·®ä»5é™ä½åˆ°2è¿›è¡Œè§‚å¯Ÿï¼Œå‘ç°æœç„¶æ¨¡ç³Šçš„ç¨‹åº¦é™ä½äº†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233749131.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

å¦‚æœè¦å¯¹ä¸€å¼ å½©è‰²å›¾åƒè¿›è¡Œé«˜æ–¯æ¨¡ç³Šï¼ˆå½©è‰²å›¾å½¢å°±æ˜¯å¤šé€šé“å›¾å½¢ï¼Œæˆ‘ä»¬çš„ç°åº¦å›¾åªæœ‰ä¸€ä¸ªé€šé“ï¼Œè€Œé€šå¸¸å½©è‰²å›¾å½¢æ˜¯ç”±RGBä¸‰ä¸ªé€šé“ç»„æˆçš„ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹ä»–çš„æ¯ä¸€å±‚è¿›è¡Œé«˜æ–¯æ¨¡ç³Šå³å¯ã€‚

```python
from PIL import Image
from numpy import *
from scipy.ndimage import filters
def compare(im1, im2, module = 'gray'):
    """
    åœ¨ä¸€å¼ å›¾é‡Œé¢æ˜¾ç¤ºä¸¤ä¸ªå›¾ç‰‡
    """
    fig, ax = plt.subplots(figsize=(12,8),ncols=2,nrows=1)
    ax[0].imshow(im1, module)
    ax[1].imshow(im2, module)
    plt.show()
    
im = array(Image.open("C:\\Users\\wangsy\\Desktop\\learning\\timg.jpg"))
im2 = zeros(im.shape)
for i in range(3):
    im2[:, :, i] = filters.gaussian_filter(im[:, :, i], 5)
im2 = uint8(im2)
compare(im, im2)
```

æ•ˆæœå¦‚ä¸‹ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233757627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

å°†æ ‡å‡†å·®é™ä½åˆ°2ï¼Œæ•ˆæœå¦‚ä¸‹

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233804321.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

å¯¹äºä¸‰é€šé“ï¼Œæˆ‘äº§ç”Ÿäº†ä¸€ç§å¾ˆå¥‡è‘©çš„æƒ³æ³•ï¼Œ é‚£å°±æ˜¯å¦‚æœæ¯ä¸€å±‚ç”¨äºæ¨¡ç³Šçš„æ ‡å‡†å·®ä¸ä¸€æ ·ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘å°†æ¨¡ç³Šçš„å€¼ä»å…¨éƒ½æ˜¯äº”æ”¹ä¸ºäº†i*3ï¼š

```python
im2[:, :, i] = filters.gaussian_filter(im[:, :, i], i*3)
```

æ¨¡ç³Šåçš„å›¾ç‰‡å˜æˆäº†è¿™æ ·ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233812348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

æˆ‘ä»¬å¯ä»¥ç†è§£ï¼Œå› ä¸ºå›¾åƒä¸­çš„çº¢è‰²è¢«æ¨¡ç³Šçš„è¾ƒå°‘ï¼Œæ¯”è¾ƒå¼ºçƒˆï¼Œè€Œè“è‰²å’Œç»¿è‰²è¢«æ¨¡ç³Šçš„ç¨‹åº¦è¾ƒå¤§ï¼Œæ— æ³•ä¿æŒåŸæ¥çš„äºšå­ï¼Œæ‰€ä»¥çº¢è‰²çš„æ¡†æ¶è¢«æ˜¾ç°å‡ºæ¥ã€‚

å°†æ¨¡ç³Šå€¼è°ƒèŠ‚åˆ°i*20ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œ è¿™å˜æˆäº†ä¸€å¼ å…·æœ‰é­”å¹»ç°å®ä¸»ä¹‰çš„å›¾ç‰‡ğŸ˜‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2020040723382746.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

### å›¾åƒå¯¼æ•°

##### å‚è€ƒèµ„æ–™

[1] [è¾¹ç¼˜æ£€æµ‹çš„å„ç§å¾®åˆ†ç®—å­æ¯”è¾ƒ](https://www.cnblogs.com/molakejin/p/5683372.html)

ä»ä¹¦ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨å¾ˆå¤šåº”ç”¨ä¸­å›¾åƒå¼ºåº¦çš„å˜åŒ–æƒ…å†µæ˜¯éå¸¸é‡è¦çš„ä¿¡æ¯ã€‚å¼ºåº¦çš„å˜åŒ–å¯ä»¥ç”¨ç°åº¦å›¾åƒ$I$çš„$x$å’Œ$y$æ–¹å‘å¯¼æ•°$I_x$å’Œ$I_y$è¿›è¡Œæè¿°ã€‚

æ¢¯åº¦ä¹‹ä¸­åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š

* **æ¢¯åº¦çš„å¤§å°**ï¼š

  $|\Delta I| = \sqrt{I_x^2 + I_y^2}$

  ä»–æè¿°äº†å›¾åƒå˜åŒ–çš„å¼ºå¼±

* **æ¢¯åº¦çš„è§’åº¦**ï¼š

  $\alpha = arctan2(I_y,I_x)$

  æè¿°äº†å›¾åƒä¸­åœ¨æ¯ä¸€ä¸ªç‚¹ä¸Šå¼ºåº¦å˜åŒ–çš„æœ€å¤§æ–¹å‘ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¦»æ•£ç‚¹è¿‘ä¼¼çš„æ–¹å¼æ¥è®¡ç®—å›¾åƒçš„å¯¼æ•°ã€‚å›¾åƒçš„å¯¼æ•°å¯ä»¥é€šè¿‡å·ç§¯ç®€å•åœ°å®ç°ï¼š
$$
I_x = I * D_x ,I_y = I*D_y
$$
å¯¹äº$D_x$å’Œ$D_y$ï¼Œé€šå¸¸é€‰æ‹© Prewitt æ»¤æ³¢å™¨ï¼š
$$
D_x = \left[
\begin{matrix}
-1&0&1\\
-1&0&1\\
-1&0&1
\end{matrix}
\right],
D_y = \left[
\begin{matrix}
-1&-1&-1\\
0&0&0\\
1&1&1
\end{matrix}
\right]
$$
æˆ–è€…æ˜¯ Sobel æ»¤æ³¢å™¨ï¼š
$$
D_x = \left[
\begin{matrix}
-1&0&1\\
-2&0&2\\
-1&0&1
\end{matrix}
\right],
D_y = \left[
\begin{matrix}
-1&-2&-1\\
0&0&0\\
1&2&1
\end{matrix}
\right]
$$


å¦‚æœä½ çœ‹æ‡‚äº†ä¸Šä¸€èŠ‚åƒå…³äº**ä»€ä¹ˆæ˜¯æ»¤æ³¢å™¨**çš„é—®é¢˜çš„è¯ï¼Œè¿™é‡Œåº”è¯¥ä¸éš¾ç†è§£ï¼Œå¦‚æœä½ æ²¡çœ‹æ‡‚ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯æˆ‘æ²¡æœ‰è®²æ¸…æ¥šï¼Œä½ å¯ä»¥å»ç½‘ä¸Šæœé›†ä¸€äº›è§†é¢‘æ•™ç¨‹æˆ–æ˜¯åšå®¢å¸®åŠ©è‡ªå·±ç†è§£ã€‚è¿™ä¸¤ç§æ»¤æ³¢å™¨çš„åŒºåˆ«æ˜¯ï¼š æ®ç»éªŒå¾—çŸ¥Sobelè¦æ¯”Prewittæ›´èƒ½å‡†ç¡®æ£€æµ‹å›¾åƒè¾¹ç¼˜ã€‚ 

ä¸‹é¢çœ‹ä¸€ä¸‹æ•ˆæœ:

```python
from PIL import Image
from numpy import *
from scipy.ndimage import filters

def compare(im1, im2, module = 'gray'):
    """
    åœ¨ä¸€å¼ å›¾é‡Œé¢æ˜¾ç¤ºä¸¤ä¸ªå›¾ç‰‡
    """
    fig, ax = plt.subplots(figsize=(12,8),ncols=2,nrows=1)
    ax[0].imshow(im1, module)
    ax[1].imshow(im2, module)
    plt.show()
    
    
im = array(Image.open("C:\\Users\\wangsy\\Desktop\\learning\\timg.jpg").convert("L"))

# Sobel
imx = zeros(im.shape)
filters.sobel(im,1,imx)

imy = zeros(im.shape)
filters.sobel(im,0,imy)

magnitude = sqrt(imx**2 + imy**2)
compare(im, magnitude)
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233841758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)

ä¸Šé¢å±•ç¤ºçš„æ˜¯æœ€åæå–çš„Xè½´å’ŒYè½´ç»¼åˆçš„æ¢¯åº¦å›¾

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200407233849490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE3ODUzNjEz,size_16,color_FFFFFF,t_70)
ä¸Šé¢ä¸¤å¼ åˆ†åˆ«æ˜¯Xè½´å’ŒYè½´æ£€æµ‹çš„ã€‚

ä»Šå¤©å…ˆåˆ°è¿™é‡Œã€‚